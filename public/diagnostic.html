<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Freighter Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stellar-freighter-api/5.0.0/index.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 40px;
            background: #1a1a2e;
            color: white;
        }
        .box {
            background: #16213e;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 2px solid #0f3460;
        }
        button {
            background: #e94560;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover { background: #c23b52; }
        .green { color: #10b981; }
        .red { color: #ef4444; }
        .yellow { color: #f59e0b; }
    </style>
</head>
<body>
    <h1>üîç Ultimate Freighter Diagnostic</h1>
    
    <div class="box">
        <h2>Step 1: Basic Detection</h2>
        <button onclick="test1()">Test: Is window.freighterApi defined?</button>
        <div id="test1"></div>
    </div>

    <div class="box">
        <h2>Step 2: Wait & Retry</h2>
        <button onclick="test2()">Test: Wait 10 seconds for Freighter</button>
        <div id="test2"></div>
    </div>

    <div class="box">
        <h2>Step 3: Check All Extension APIs</h2>
        <button onclick="test3()">Test: List all window properties</button>
        <div id="test3"></div>
    </div>

    <div class="box">
        <h2>Step 4: Manual Connect</h2>
        <button onclick="test4()">Test: Try to connect</button>
        <div id="test4"></div>
    </div>

    <div class="box" id="info">
        <h2>üìã System Info</h2>
        <p><strong>User Agent:</strong> <span id="ua"></span></p>
        <p><strong>Browser:</strong> <span id="browser"></span></p>
        <p><strong>Extensions Check:</strong> Open <code>chrome://extensions/</code> or <code>about:addons</code></p>
    </div>

    <script>
        // Display user agent
        document.getElementById('ua').textContent = navigator.userAgent;
        
        // Detect browser
        const isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
        const isFirefox = /Firefox/.test(navigator.userAgent);
        const isBrave = navigator.brave !== undefined;
        
        let browserName = 'Unknown';
        if (isBrave) browserName = 'Brave';
        else if (isChrome) browserName = 'Chrome/Chromium';
        else if (isFirefox) browserName = 'Firefox';
        
        document.getElementById('browser').textContent = browserName;

        function test1() {
            const result = document.getElementById('test1');
            result.innerHTML = '<p>Checking...</p>';
            
            setTimeout(() => {
                if (typeof window.freighterApi !== 'undefined') {
                    result.innerHTML = `
                        <p class="green">‚úÖ SUCCESS: window.freighterApi exists!</p>
                        <p>Type: ${typeof window.freighterApi}</p>
                        <p>Methods: ${Object.keys(window.freighterApi).join(', ')}</p>
                    `;
                } else {
                    result.innerHTML = `
                        <p class="red">‚ùå FAIL: window.freighterApi is undefined</p>
                        <p class="yellow">This means Freighter is not injecting its API into the page.</p>
                    `;
                }
            }, 100);
        }

        function test2() {
            const result = document.getElementById('test2');
            result.innerHTML = '<p>Waiting for 10 seconds...</p>';
            
            let attempts = 0;
            const maxAttempts = 100;
            
            const interval = setInterval(() => {
                attempts++;
                
                if (window.freighterApi) {
                    clearInterval(interval);
                    result.innerHTML = `
                        <p class="green">‚úÖ SUCCESS: Found after ${attempts * 0.1} seconds!</p>
                        <p>Freighter loaded successfully.</p>
                    `;
                } else if (attempts >= maxAttempts) {
                    clearInterval(interval);
                    result.innerHTML = `
                        <p class="red">‚ùå FAIL: Not found after 10 seconds</p>
                        <p class="yellow">Freighter is definitely not loading. Check installation.</p>
                    `;
                }
            }, 100);
        }

        function test3() {
            const result = document.getElementById('test3');
            result.innerHTML = '<p>Scanning window properties...</p>';
            
            setTimeout(() => {
                const props = Object.keys(window).filter(key => 
                    key.toLowerCase().includes('freighter') || 
                    key.toLowerCase().includes('stellar') ||
                    key.toLowerCase().includes('wallet')
                );
                
                if (props.length > 0) {
                    result.innerHTML = `
                        <p class="green">Found ${props.length} related properties:</p>
                        <ul>${props.map(p => '<li>' + p + '</li>').join('')}</ul>
                    `;
                } else {
                    result.innerHTML = `
                        <p class="yellow">‚ö†Ô∏è No Freighter-related properties found on window object</p>
                        <p>This suggests the extension is not injecting anything.</p>
                    `;
                }
            }, 100);
        }

        async function test4() {
            const result = document.getElementById('test4');
            
            if (!window.freighterApi) {
                result.innerHTML = '<p class="red">‚ùå Cannot test: freighterApi not available</p>';
                return;
            }
            
            result.innerHTML = '<p>Attempting to connect...</p>';
            
            try {
                const response = await window.freighterApi.requestAccess();
                
                if (response.error) {
                    result.innerHTML = `<p class="red">‚ùå Error: ${response.error}</p>`;
                } else if (response.address) {
                    result.innerHTML = `
                        <p class="green">‚úÖ SUCCESS! Connected!</p>
                        <p>Address: ${response.address}</p>
                    `;
                }
            } catch (err) {
                result.innerHTML = `<p class="red">‚ùå Exception: ${err.message}</p>`;
            }
        }

        // Auto-run test1 on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                test1();
            }, 1000);
        });
    </script>
</body>
</html>
