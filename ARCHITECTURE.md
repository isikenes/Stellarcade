# ðŸ—ï¸ Stellarcade Architecture

## ðŸ“ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Browser                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Stellarcade Frontend (Next.js)            â”‚ â”‚
â”‚  â”‚                                                        â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚ â”‚
â”‚  â”‚  â”‚  index.tsx   â”‚â”€â”€â”€â”€â”€â”€â–¶  â”‚   main.tsx   â”‚           â”‚ â”‚
â”‚  â”‚  â”‚  (Connect)   â”‚         â”‚   (Game UI)  â”‚           â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ â”‚
â”‚  â”‚                                   â”‚                    â”‚ â”‚
â”‚  â”‚                                   â–¼                    â”‚ â”‚
â”‚  â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ â”‚
â”‚  â”‚                          â”‚  stellar.ts     â”‚          â”‚ â”‚
â”‚  â”‚                          â”‚  (SDK Utils)    â”‚          â”‚ â”‚
â”‚  â”‚                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â”‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚         Freighter Wallet         â”‚                    â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚                    â”‚ â”‚
â”‚  â”‚  â”‚ window.freighterApi      â”‚    â”‚                    â”‚ â”‚
â”‚  â”‚  â”‚ - requestAccess()        â”‚    â”‚                    â”‚ â”‚
â”‚  â”‚  â”‚ - signTransaction()      â”‚â—€â”€â”€â”€â”˜                    â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ Signed Transactions
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Stellar Testnet                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Soroban RPC Server                        â”‚ â”‚
â”‚  â”‚        https://soroban-testnet.stellar.org            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                       â”‚                                      â”‚
â”‚                       â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚          Smart Contract (arcade_reward)                â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚  Functions:                                      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - submit_score(player, score)                   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - get_top_score()                              â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - get_last_player()                            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - claim_reward(player)                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                                                  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  Storage:                                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - TopScore (PlayerScore)                       â”‚ â”‚ â”‚
â”‚  â”‚  â”‚  - LastPlayer (Address)                         â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ”„ User Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User       â”‚
â”‚   Opens      â”‚
â”‚   Browser    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  index.tsx                  â”‚
â”‚  - Check Freighter          â”‚
â”‚  - Show Connect Button      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Click Connect
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Freighter Popup            â”‚
â”‚  - Approve Access           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Approve
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Save to localStorage       â”‚
â”‚  Redirect to /main          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  main.tsx                   â”‚
â”‚  - Show Wallet Address      â”‚
â”‚  - Show Input Forms         â”‚
â”‚  - Show Leaderboard         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ Enter Name & Score
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Click Submit Score         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  stellar.ts                 â”‚
â”‚  - Build Transaction        â”‚
â”‚  - Call submit_score()      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Freighter Signs TX         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Send to Soroban RPC        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Contract Executes          â”‚
â”‚  - Update Storage           â”‚
â”‚  - Update Top Score         â”‚
â”‚  - Set Last Player          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Success Response           â”‚
â”‚  - Update UI                â”‚
â”‚  - Show Success Message     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ“ File Organization

```
Stellarcade/
â”‚
â”œâ”€â”€ ðŸ“„ Configuration Files
â”‚   â”œâ”€â”€ package.json           # Dependencies & scripts
â”‚   â”œâ”€â”€ tsconfig.json          # TypeScript config
â”‚   â”œâ”€â”€ tailwind.config.ts     # Tailwind CSS config
â”‚   â”œâ”€â”€ next.config.js         # Next.js config
â”‚   â”œâ”€â”€ postcss.config.js      # PostCSS config
â”‚   â”œâ”€â”€ .gitignore             # Git ignore rules
â”‚   â”œâ”€â”€ .env.example           # Environment template
â”‚   â””â”€â”€ next-env.d.ts          # Next.js types
â”‚
â”œâ”€â”€ ðŸ“š Documentation
â”‚   â”œâ”€â”€ README.md              # Project overview
â”‚   â”œâ”€â”€ QUICKSTART.md          # Setup guide
â”‚   â”œâ”€â”€ CHECKLIST.md           # Pre-deployment checklist
â”‚   â”œâ”€â”€ PROJECT_SUMMARY.md     # Complete summary
â”‚   â”œâ”€â”€ ARCHITECTURE.md        # This file
â”‚   â”œâ”€â”€ pdr.md                 # Product requirements
â”‚   â”œâ”€â”€ FreighterWalletDocs.md # Wallet integration docs
â”‚   â””â”€â”€ StellarDeploy.md       # Deployment guide
â”‚
â”œâ”€â”€ ðŸŽ¨ Frontend
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ _app.tsx           # App wrapper
â”‚   â”‚   â”œâ”€â”€ index.tsx          # Connect page
â”‚   â”‚   â””â”€â”€ main.tsx           # Main game UI
â”‚   â”‚
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â””â”€â”€ globals.css        # Global styles
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ stellar.ts         # Stellar SDK integration
â”‚   â”‚
â”‚   â””â”€â”€ types/
â”‚       â”œâ”€â”€ freighter.d.ts     # Freighter types
â”‚       â””â”€â”€ contract.ts        # Contract types
â”‚
â”œâ”€â”€ ðŸ“œ Smart Contract
â”‚   â””â”€â”€ contract/
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â””â”€â”€ lib.rs         # Contract implementation
â”‚       â”œâ”€â”€ Cargo.toml         # Rust dependencies
â”‚       â””â”€â”€ README.md          # Contract docs
â”‚
â””â”€â”€ ðŸ› ï¸ Scripts
    â”œâ”€â”€ build-contract.ps1     # Build script
    â””â”€â”€ test-contract.ps1      # Test script
```

## ðŸ”Œ Data Flow

### Submit Score Flow
```
User Input (Name + Score)
      â”‚
      â–¼
validate input
      â”‚
      â–¼
stellar.ts: submitScore()
      â”‚
      â”œâ”€â–¶ Load account from Horizon
      â”œâ”€â–¶ Build contract call operation
      â”œâ”€â–¶ Create transaction
      â”œâ”€â–¶ Convert to XDR
      â”‚
      â–¼
Freighter: signTransaction()
      â”‚
      â–¼
Submit to Soroban RPC
      â”‚
      â–¼
Contract: submit_score()
      â”‚
      â”œâ”€â–¶ require_auth(player)
      â”œâ”€â–¶ Update LastPlayer in storage
      â”œâ”€â–¶ Check current TopScore
      â”œâ”€â–¶ Update TopScore if higher
      â”‚
      â–¼
Transaction Result
      â”‚
      â–¼
Update UI with success/error
```

### Get Top Score Flow
```
Component Mount/Refresh
      â”‚
      â–¼
stellar.ts: getTopScore()
      â”‚
      â–¼
Query Contract State
      â”‚
      â–¼
Parse PlayerScore data
      â”‚
      â–¼
Update UI with:
  - Top Score (number)
  - Top Player (address)
```

## ðŸ” Security & Authentication

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User Action       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Freighter Signs TX  â”‚
â”‚ (Private Key Secure)â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Contract Verifies   â”‚
â”‚ require_auth()      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Execute if Verified â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ðŸ’¾ Storage Structure

```
Contract Storage (Persistent)
â”‚
â”œâ”€â”€ DataKey::TopScore
â”‚   â””â”€â”€ PlayerScore {
â”‚       â”œâ”€â”€ player: Address
â”‚       â””â”€â”€ score: u32
â”‚       }
â”‚
â””â”€â”€ DataKey::LastPlayer
    â””â”€â”€ Address
```

## ðŸŽ¯ Component Responsibilities

| Component | Responsibility |
|-----------|---------------|
| `index.tsx` | Wallet connection only |
| `main.tsx` | Game UI & state management |
| `stellar.ts` | Blockchain interactions |
| `freighter.d.ts` | Type definitions |
| `lib.rs` | Smart contract logic |

## ðŸ”„ State Management

### Frontend State (React)
- `walletAddress` - Connected wallet
- `playerName` - Player input
- `score` - Score input
- `topScore` - Current top score
- `topPlayer` - Top player name
- `lastPlayer` - Last player
- `isTopPlayer` - User has top score

### Contract State (Soroban)
- `TopScore` - Highest score + player
- `LastPlayer` - Last player address

## ðŸ“¡ API Endpoints

### Stellar Testnet
- **Horizon**: `https://horizon-testnet.stellar.org`
- **Soroban RPC**: `https://soroban-testnet.stellar.org`

### Contract Functions (via Soroban RPC)
- `submit_score(player: Address, score: u32)`
- `get_top_score() -> Option<PlayerScore>`
- `get_last_player() -> Option<Address>`
- `claim_reward(player: Address) -> bool`

---

This architecture ensures:
- âœ… Clear separation of concerns
- âœ… Secure wallet integration
- âœ… Simple but complete functionality
- âœ… Easy to understand and maintain
- âœ… Ready for future enhancements
